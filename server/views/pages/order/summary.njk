{% extends "../../partials/layout.njk" %}

{% set pageTitle = "Application summary - " + applicationName %}
{% set mainClasses = "app-container govuk-body" %}
{% set formDownloadIcon = '/assets/images/form_download.svg' %}
{% from "moj/components/page-header-actions/macro.njk" import mojPageHeaderActions %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/task-list/macro.njk" import govukTaskList %}

{% block content %}

  {{ govukBackLink({
  text: "Back",
  href: "/"
}) }}

  <div class="homepage-content">
    {{ mojPageHeaderActions({
  heading: {
    text: "Apply for electronic monitoring"
  }
}) }}

  </div>
  <p class="govuk-body-l">
    Complete all sections before submitting the form.
  </p>

  {% macro _lineItem(name, url, complete, describedBy) %}
    <li class="govuk-task-list__item govuk-task-list__item--with-link">
      <div class="govuk-task-list__name-and-hint">
        <a class="govuk-link govuk-task-list__link" href="{{ url }}" aria-describedby="{{ describedBy }}">
          {{ name }}
        </a>
      </div>
      {% if complete === true %}
        <div class="govuk-task-list__status" >
          <strong class="govuk-tag govuk-tag--green">Complete</strong>
        </div>
      {% else %}
        <div class="govuk-task-list__status" >
          <strong class="govuk-tag govuk-tag--grey">Incomplete</strong>
        </div>
      {% endif %}
    </li>
  {% endmacro %}

  <ul class="govuk-task-list">
    {% for section, tasks in sections %}
      {{ _lineItem(section | replace("_", " ") | capitalize, tasks[0].path, false, "order-section-" + section | replace("_", "-") | lower) }}
    {% endfor %}
</ul>

{% if order.status == "IN_PROGRESS" %}
  <form action="/order/{{ order.id }}/submit" method="post">
    <input type="hidden" name="_csrf" value="{{ csrfToken }}">
    <div class="govuk-button-group">
      {{ govukButton({
            text: "Submit order"
        }) }}
    </div>
  </form>
{% else %}
  <img src="{{ formDownloadIcon }}" alt="Icon of a form">
  {{ govukButton({
          text: "Get tag request form summary for download",
          href: "/order/" + orderId + "/receipt/view",
          classes: "govuk-button--secondary"
      }) }}

  <div class="govuk-button-group">
    <a id="backToSearch" class="govuk-link" href="/">Return to order search view</a>
  </div>
{% endif %}
{% endblock %}