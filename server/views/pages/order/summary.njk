{% extends "../../partials/layout.njk" %}

{% set pageTitle = applicationName + " - Form Details" %}
{% set error = error %}
{% set mainClasses = "app-container govuk-body" %}
{% from "moj/components/page-header-actions/macro.njk" import mojPageHeaderActions %}
{%- from "moj/components/search/macro.njk" import mojSearch -%}
{%- from "moj/components/pagination/macro.njk" import mojPagination -%}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

{% block content %}

{{ govukBackLink({
  text: "Back",
  href: "/"
}) }}

<div class="homepage-content">
  {{ mojPageHeaderActions({
  heading: {
    text: "Apply for electronic monitoring"
  }
}) }}
</div>

  {% if error %}
  {{ govukErrorSummary({
    titleText: "There is a problem",
    errorList: [
      {
        text: error,
        href: "#"
      }
    ]
  }) }}
  {% endif %}

  <p class="govuk-body-l">
    Complete all sections before submitting the form.
  </p>

{% macro _lineItem(name, order, url, complete, describedBy) %}
  <li class="govuk-task-list__item govuk-task-list__item--with-link">
    <div class="govuk-task-list__name-and-hint">
      <a class="govuk-link govuk-task-list__link" href="/order/{{ order.id }}{{ url }}" aria-describedby="{{ describedBy }}">
          {{ name }}
      </a>
    </div>
    {% if complete === true %}
      <div class="govuk-task-list__status" >
        <strong class="govuk-tag govuk-tag--green">Complete</strong>
      </div>
    {% else %}               
      <div class="govuk-task-list__status" >
        <strong class="govuk-tag govuk-tag--grey">Incomplete</strong>
      </div>
    {% endif %}
  </li>
{% endmacro %}

  <ul class="govuk-task-list">
    {{ _lineItem("About the device wearer", order, "/about-the-device-wearer", order.deviceWearer.isComplete, "order-section-device-wearer") }}
    {{ _lineItem("Contact information", order, "/contact-information/contact-details", order.contactDetails.isComplete, "order-section-contact-details") }}
    {{ _lineItem("Installation and risk", order, "/installation-and-risk", order.installationAndRisk.isComplete, "order-section-installation-and-risk") }}
    {{ _lineItem("Monitoring conditions", order, "/monitoring-conditions", order.monitoringConditions.isComplete, "order-section-monitoring-conditions") }}
    {{ _lineItem("Attachments", order, "/attachments", order.attachments.isComplete, "order-section-attachments") }}
  </ul>

  {% if order.status == "IN_PROGRESS" %}
    <form action="/order/{{ order.id }}/submit" method="post">
      <input type="hidden" name="_csrf" value="{{ csrfToken }}">
      <div class="govuk-button-group">
        {{ govukButton({
            text: "Submit order",
            disabled: not order.isValid
        }) }}
      </div>
    </form>
  {% else %}
    <div class="govuk-button-group">
      <a id="backToSearch" class="govuk-link" href="/">Return to order search view</a>
    </div>
  {% endif %}
{% endblock %}
